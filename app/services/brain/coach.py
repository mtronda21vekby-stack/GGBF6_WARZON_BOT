from __future__ import annotations

from dataclasses import dataclass


@dataclass
class CoachOutput:
    text: str


def _pick_focus(msg: str) -> str:
    m = msg.lower()
    if any(k in m for k in ["–∞–∏–º", "aim", "–º–µ—Ç–∫", "—Ç—Ä–µ–∫", "–æ—Ç–¥–∞—á", "—Ä–µ–∞–∫—Ü"]):
        return "AIM"
    if any(k in m for k in ["–º—É–≤", "movement", "—Å–ª–∞–π–¥", "—Å—Ç—Ä–µ–π—Ñ", "–ø—Ä—ã–∂", "–±—Ö–æ–ø", "—É–∫–ª–æ–Ω"]):
        return "MOVEMENT"
    if any(k in m for k in ["–ø–æ–∑–∏", "position", "—Ä–æ—Ç–∞—Ü", "—É–≥–æ–ª", "—Ö–∞–π–≥—Ä–∞—É–Ω–¥", "–ø–∏–∫", "–ø—É—à", "–∑–æ–Ω–∞"]):
        return "POSITIONING"
    return "HYBRID"


def build_plan(game: str, device: str, diff: str, msg: str) -> CoachOutput:
    focus = _pick_focus(msg)

    header = f"üéØ –†–∞–∑–±–æ—Ä (game={game.upper()} | input={device.upper()} | diff={diff.upper()})"
    diag = f"üß© –§–æ–∫—É—Å: {focus}"

    questions = (
        "–û—Ç–≤–µ—Ç—å 1 —Å—Ç—Ä–æ–∫–æ–π:\n"
        "1) –ì–¥–µ —É–º–µ—Ä? (—Ç–æ—á–∫–∞/—Å–∏—Ç—É–∞—Ü–∏—è)\n"
        "2) –ß–µ–º —É–±–∏–ª–∏? (AR/SMG/Sniper/Shotgun)\n"
        "3) –ß—Ç–æ –¥–µ–ª–∞–ª –∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã –¥–æ —Å–º–µ—Ä—Ç–∏?\n"
    )

    drills = []
    if focus in ("AIM", "HYBRID"):
        drills += [
            "AIM: 10 –º–∏–Ω —Ç—Ä–µ–∫–∏–Ω–≥ ‚Üí 5 –º–∏–Ω —Ñ–ª–∏–∫ ‚Üí 5 –º–∏–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—Ç–¥–∞—á–∏ (–æ–¥–Ω–∞ –ø—É—à–∫–∞).",
            "AIM: –ø—Ä–∞–≤–∏–ª–æ ‚Äî *—Å—Ç—Ä–µ–ª—è–π —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø—Ä–∏—Ü–µ–ª —É–∂–µ ‚Äú–ø—Ä–∏–ª–∏–ø‚Äù* (–Ω–µ —Å–ø–µ—à–∏ –ø–µ—Ä–≤—ã–º –≤—ã—Å—Ç—Ä–µ–ª–æ–º).",
        ]
    if focus in ("MOVEMENT", "HYBRID"):
        drills += [
            "MOVEMENT: 10 –º–∏–Ω ‚Äî –ø–∏–∫ —É–≥–ª–∞: wide‚Üítight, –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –≤ —É–∫—Ä—ã—Ç–∏–µ.",
            "MOVEMENT: –ø—Ä–∞–≤–∏–ª–æ ‚Äî *–¥–≤–∏–∂–µ–Ω–∏–µ = —Å–º–µ–Ω–∞ —É–≥–ª–∞*, –Ω–µ –±–µ–≥–∞–π –ø–æ –ø—Ä—è–º–æ–π –ø–æ–¥ –ø—Ä–∏—Ü–µ–ª–æ–º.",
        ]
    if focus in ("POSITIONING", "HYBRID"):
        drills += [
            "POS: 5 –º–∏–Ω ‚Äî –æ—Ç–º–µ—Ç—å 3 safe-—É–≥–ª–∞ (–∫—É–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è) –ø–µ—Ä–µ–¥ —Ñ–∞–π—Ç–æ–º.",
            "POS: –ø—Ä–∞–≤–∏–ª–æ ‚Äî *—Å–Ω–∞—á–∞–ª–∞ –ø–æ–∑–∏—Ü–∏—è, –ø–æ—Ç–æ–º –¥—É—ç–ª—å* (–≤—Ä—ã–≤–∞–µ–º—Å—è —Ç–æ–ª—å–∫–æ —Å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º).",
        ]

    week = (
        "üìÖ –ü–ª–∞–Ω –Ω–∞ 7 –¥–Ω–µ–π:\n"
        "–î1‚Äì–î2: 30 –º–∏–Ω drills + 3 –∫–∞—Ç–∫–∏ —Å –æ–¥–Ω–æ–π —Ü–µ–ª—å—é\n"
        "–î3‚Äì–î4: 45 –º–∏–Ω drills + VOD 1 —Å–º–µ—Ä—Ç–∏ (–ø–∏—à–∏ –º–Ω–µ)\n"
        "–î5‚Äì–î7: 60 –º–∏–Ω drills + —Ä–∞–Ω–≥–æ–≤—ã–µ/—Å–∫—Ä–∏–º—ã\n"
        "–¶–µ–ª—å: —É–º–µ–Ω—å—à–∏—Ç—å ‚Äú–±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Å–º–µ—Ä—Ç–∏‚Äù –Ω–∞ 30%."
    )

    text = "\n\n".join([header, diag, questions, "üî• –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:", "\n".join(f"‚Ä¢ {x}" for x in drills), week])
    return CoachOutput(text=text)
